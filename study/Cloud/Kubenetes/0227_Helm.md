# Helm
## helm이란?  
쿠버네티스(Kubernetes)를 위한 패키지 관리자, 배포시에 사용함  
- 여러 yaml파일을 한번에 helm으로 묶어서 사용 가능
- 개발/배포/운영용 다양한 설정값들을 `values.yaml`에서 한번에 관리 가능함
- 버전 rollback이 쉬움
- 잘 만들어져있는 차트를 다운받아서 바로 사용할 수 있음

## 설치하기
[사이트](https://helm.sh/ko/docs/intro/install)
```bash
winget install Helm.Helm
```

[helm사이트](https://helm.sh/ko/)
사이트에서 차트 누르면 Hub가 뜸  
여기서 원하는 차트 다운받아서 사용하면 됨  
* 비트나미 - 오픈소스를 빠르게 다운로드 할 수 있게 도와주는 플랫폼  

----
## 1️⃣ helm 초기화(init같은거)
```
helm create mynginx
```

Chart.yaml
```
# 차트의 유형은 'application(애플리케이션)' 또는 'library(라이브러리)' 중 하나.
#
# 애플리케이션 차트: 배포 가능한 버전 아카이브로 패키징할 수 있는 템플릿들의 모음. 📦
#
# 라이브러리 차트: 차트 개발자에게 유용한 유틸리티나 함수를 제공. 🛠️
# 애플리케이션 차트의 의존성(dependency)으로 포함되어 렌더링 과정에 기능을 주입하는 역할.
# 라이브러리 차트는 자체적인 템플릿을 정의하지 않으므로 직접 배포는 불가능. 🚫
type: application

# 이 항목은 '차트 자체'의 버전. 🔖
# 차트나 템플릿, 앱 버전을 수정할 때마다 이 숫자를 높여야 함.
# 버전 형식은 시맨틱 버전 관리(https://semver.org/) 규칙을 따름. 🔢
version: 0.1.0

# 이 항목은 배포되는 '애플리케이션(예: Nginx)'의 실제 버전. 🚀
# 애플리케이션을 변경할 때마다 이 숫자를 높여야 함.
# 이 버전은 시맨틱 버전 관리를 반드시 따를 필요는 없으며, 사용 중인 앱의 버전을 반영.
# 가급적 따옴표("")를 사용하는 것을 권장. 💬
appVersion: "1.16.0"
```

values.yaml
```
# mynginx의 기본 설정값 정의
# 이 파일은 YAML 형식이며, 템플릿에 전달될 변수들을 선언함.

# 실행할 파드(Pod)의 복제본 개수를 설정 👥
# 자세한 정보: https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/
replicaCount: 1

# 컨테이너 이미지 설정 🖼️
# 자세한 정보: https://kubernetes.io/docs/concepts/containers/images/
image:
  # 이미지 저장소 (기본값은 nginx)
  repository: nginx
  # 이미지 풀(Pull) 정책. IfNotPresent는 로컬에 없을 때만 다운로드한다는 의미.
  pullPolicy: IfNotPresent
  # 이미지 태그를 덮어씁니다. 기본값은 Chart.yaml의 appVersion을 사용.
  tag: ""

# 프라이빗 저장소에서 이미지를 가져올 때 필요한 인증 정보(Secret) 🔑
imagePullSecrets: []
# 차트 이름을 강제로 변경하거나 고정하고 싶을 때 사용.
nameOverride: ""
fullnameOverride: ""

# 서비스 계정(Service Account) 설정 👤
# 자세한 정보: https://kubernetes.io/docs/concepts/security/service-accounts/
serviceAccount:
  # 서비스 계정 생성 여부
  create: true
  # 서비스 계정의 API 인증 정보를 자동으로 마운트할지 여부
  automount: true
  # 서비스 계정에 추가할 주석(Annotations)
  annotations: {}
  # 사용할 서비스 계정 이름. 비어있고 create가 true면 이름이 자동 생성됨.
  name: ""

# 파드(Pod)에 추가할 주석 설정 📝
podAnnotations: {}
# 파드(Pod)에 추가할 라벨 설정 🏷️
podLabels: {}

# 파드 수준의 보안 설정 (파일 시스템 그룹 등) 🛡️
podSecurityContext: {}
  # fsGroup: 2000

# 컨테이너 수준의 보안 설정 (실행 권한, 사용자 ID 등) 🔒
securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# 서비스(Service) 설정 - 네트워크 노출 방식 🌐
# 자세한 정보: https://kubernetes.io/docs/concepts/services-networking/service/
service:
  # 서비스 타입 (ClusterIP, NodePort, LoadBalancer 등)
  type: ClusterIP
  # 서비스가 사용할 포트 번호
  port: 80

# 인그레스(Ingress) 설정 - 외부 접속 경로 관리 🛣️
# 자세한 정보: https://kubernetes.io/docs/concepts/services-networking/ingress/
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
    # - secretName: chart-example-tls
    #   hosts:
    #     - chart-example.local

# Gateway API HTTPRoute 설정 (최신 방식의 서비스 노출) 🚦
# 클러스터에 Gateway API 리소스와 컨트롤러가 설치되어 있어야 함.
httpRoute:
  enabled: false
  annotations: {}
  # 이 루트가 연결될 게이트웨이 참조
  parentRefs:
  - name: gateway
    sectionName: http
  # 매칭될 호스트 이름
  hostnames:
  - chart-example.local
  # 규칙 및 필터 설정
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /headers

# 자원(CPU/메모리) 할당 제한 설정 ⚙️
# 처음에는 비워두고 환경에 맞춰 직접 설정하는 것을 권장.
resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

# 애플리케이션 상태 확인(Liveness/Readiness Probe) 설정 🩺
# Liveness: 앱이 살아있는지 확인, Readiness: 트래픽을 받을 준비가 됐는지 확인.
livenessProbe:
  httpGet:
    path: /
    port: http
readinessProbe:
  httpGet:
    path: /
    port: http

# 오토스케일링(HPA) 설정 - 부하에 따른 파드 자동 증설 ⚖️
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

# 추가 볼륨(저장소) 정의 💾
volumes: []

# 컨테이너 내부에 볼륨을 마운트할 경로 설정 📂
volumeMounts: []

# 특정 노드에 파드를 배치하기 위한 선택기 📍
nodeSelector: {}

# 특정 노드의 제약 조건(Taint)을 견디고 배치되도록 하는 설정 🏗️
tolerations: []

# 노드나 파드 간의 배치 관계 설정 (선호도) 🖇️
affinity: {}
```
----
## 2️⃣ Helm Chart 설치
dir에 mynginx가 보이는 위치에서 해야함
```
helm install [chart이름] [packge위치]

helm install t1 mynginx

출력
NAME: t1
LAST DEPLOYED: Fri Feb 27 10:12:58 2026
NAMESPACE: default
STATUS: deployed
REVISION: 1
DESCRIPTION: Install complete
TEST SUITE: None
```
=> 이게 있으면 yaml create 하나하나 안 하고 install만 하면 어디서든 서비스를 사용할 수 있음
=> 하고 지정 포트로 들어가면 내가 쓴 이미지에 접속 가능

## 3️⃣ Helm repo 초기화하기
- git에 helm용 repo 생성 후 Settings -> Pages -> Branch main으로 교체 후 save -> action에 뜨는 링크 들어가면 readme 파일을 읽어옴 -> vscode에 clone

clone한 파일 터미널에서 실행하면 index.yaml파일 생성됨
```
helm repo index .
```

## 4️⃣ Helm 배포용 zip파일 만들어 배포하기
package있는 터미널에서 실행
```
helm package [Package 위치]
```
=> mynginx-0.1.0.tgz라는 배포용 압축파일이 만들어짐 -> repo있는 위치로 이동  
-> 배포 파일 repo에 넣은 이후
```
helm repo index .
```
하면 정보가 채워짐(Chart yaml의 내용이 채워짐)  
Upgrade해서 릴리즈했을 경우 Chart.yaml의 version을 0.2.0, 0.3.0등으로 업그레이드 시켜서 재배포 하면됨  
=> update 이후 확인하는 방법
```
helm list
로 이름 확인 후 기존 파일 지움

helm uninstall webserver
이후 README에 있는 update부터 실행
```


# "{{.파일위치(대문자).사용할변수.의 어떤거}}:는 연결""