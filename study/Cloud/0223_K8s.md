# 쿠버네티스
컨테이너화된 워크로드와 서비스를 관리하기 위한 이식할 수 있고, 확장 가능한 오픈소스 플랫폼

kubernetes에서 node는 컴퓨터라고 생각하면 됨: 자동생성됨
pod는 10개 생성 가능
deployments: pod가 부하가 걸릴 때 pod를 여러개로 나눠줌

명령어: `kubectl`로 시작

- 다양한 명령어 보기
```
kubectl api-resources

OR

kubectl --help
```

- 파드(Pod) 로그 설명 보기
```
kubectl logs --help
```

- Pod 생성
```
kubectl run web --image=nginx:1.28 --port 80
```
👉 이름이 web인 Pod를 생성해서
👉 nginx:1.28 이미지를 실행하고
👉 컨테이너 포트를 80으로 설정해라
![alt text](image.png)

- 서비스 Port 활성화(외부 접속 허용 설정)
```
kubectl port-forward pod/web 80:80
```

- pod 정보 보기
```
kubectl get pods

- pod들 정보 자세히 보기
kubectl get pods -o wide

- pod중에 하나(web2는 이름) 자세히 보기
kubectl get pod web2 -o yaml
```
- 접속하기
```
kubectl exec -it web -- /bin/bash
```
- nginx 명령어`curl`로 html 보기
```
curl localhost
```



# yaml파일로 컨테이너 생성

## yaml 작성시에는 Tab 사용 불가/ 무조건 들여쓰기 두번!!
```
apiVersion: v1
kind: Pod

# metadata는 pod이름
metadata:
  name: web2
spec:
  containers:
      # 여기의 name은 container 이름
      # name을 여러개 쓰면 한 pod안에 여러 컨테이너가 생김
    - name: web
      image: nginx:1.28
      # kubernets 이미지 정책상 docker hub에 없는 파일이면 이미지 다운이 안됨
      # 아래 명령어 = 이미지가 로컬에 없는 경우에만 내려받는다.
      imagePullPolicy: IfNotPresent
      #port는 안 써도 무방함
      ports:
        - containerPort: 80

```

- manifest file을 이용하여 pod생성
```
kubectl apply -f web-pod.yaml
```
-f이후는 내가 만든 yaml명으로 써야함

- pod 삭제
```
- 전부삭제
kube delete all --all

- 원하는 pod만 삭제
kubectl delete pod 파드이름
```

### 쿠버네티스 이미지 정책
이미지 풀(pull) 정책
컨테이너에 대한 imagePullPolicy와 이미지의 태그는 kubelet이 특정 이미지를 풀(다운로드)하려고 할 때 영향을 준다.

다음은 imagePullPolicy에 설정할 수 있는 값의 목록과 효과이다.

IfNotPresent
이미지가 로컬에 없는 경우에만 내려받는다.
Always
kubelet이 컨테이너를 기동할 때마다, kubelet이 컨테이너 이미지 레지스트리에 이름과 이미지의 다이제스트가 있는지 질의한다. 일치하는 다이제스트를 가진 컨테이너 이미지가 로컬에 있는 경우, kubelet은 캐시된 이미지를 사용한다. 이외의 경우, kubelet은 검색된 다이제스트를 가진 이미지를 내려받아서 컨테이너를 기동할 때 사용한다.
Never
kubelet은 이미지를 가져오려고 시도하지 않는다. 이미지가 어쨌든 이미 로컬에 존재하는 경우, kubelet은 컨테이너 기동을 시도한다. 이외의 경우 기동은 실패한다. 보다 자세한 내용은 미리 내려받은 이미지를 참조한다.
이미지 제공자에 앞서 깔린 캐시의 의미 체계는 레지스트리에 안정적으로 접근할 수 있는 한, imagePullPolicy: Always인 경우 조차도 효율적이다. 컨테이너 런타임은 노드에 이미 존재하는 이미지 레이어를 알고 다시 내려받지 않는다.