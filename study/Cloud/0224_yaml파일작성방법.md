# yaml íŒŒì¼ ì‘ì„±ë²•

yamlì´ ë­ì˜ˆìš”?  
yamlì€ markup languageê°€ ì•„ë‹ˆë‹¤. ë¼ëŠ” ì¶•ì•½ì–´  
markupì–¸ì–´ë€ htmlê°™ì´ íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì–¸ì–´  
yamlì€ íƒœê·¸ ì—†ì´ ë“¤ì—¬ì“°ê¸°ë¡œ êµ¬ë¶„í•˜ëŠ” ì–¸ì–´  

1. Pod
metadata: dataë¥¼ ì„¤ëª…í•˜ëŠ” data
spec: ì„¤ê³„ë„
- container:
image: ì´ë¯¸ì§€ë¥¼ ì–´ë–¤ ê±¸ ì‚¬ìš©í• ê±´ì§€.
name: ì»¨í…Œì´ë„ˆ ëª… ì§€ì •
metadata 
- name: ë°ì´í„°ì— ê´€í•œ ì´ë¦„
- labels: key:valueí˜•ì‹. ê·¸ë£¹ ì‹ë³„ìš©
2. Deployment
apps/v1: ì†í•´ìˆëŠ” ì§‘ë‹¨ì´ appsë‹¤.ë¼ëŠ” ì˜ë¯¸. ì†í•œ ì§‘ë‹¨ì„ êµ¬ë¶„í•´ì¤Œ
metadata:
- labels: í•„ìˆ˜ëŠ” ì•„ë‹˜. ê´€ë¦¬ë¥¼ deê°€ í•˜ê¸°ë•Œë¬¸ì— ì—¬ê¸°ëŠ” ìƒëµí•´ë„ ì˜ë¯¸ ì—†ìŒ.
- name: ì–˜ë„ ì´ë¦„ ì§€ì •
spec:
- replica: Pod ë³µì œí’ˆ ëª‡ê°œë¥¼ ë§Œë“¤ê²ƒì¸ê°€
- selector: ì–´ë–¤ ê²ƒì„ ê´€ë¦¬í• ê²ƒì¸ê°€. labelë¡œ ë¶„ë¥˜
template: ì–˜ëŠ” Deì—ë§Œ ìˆìŒ
ìƒˆë¡œ ë§Œë“¤ ë³µì œíŒŒë“œì˜ í‹€ì„ í…œí”Œë¦¿ìœ¼ë¡œ ì§¬(Pod í˜•ì‹ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•¨)


3. Service
metadata:
- name: ë„¤ì„ë§Œ ìˆìœ¼ë©´ ë¨
spec:
- type: ì™¸ë¶€ì—ì„œ ì ‘ì†í•˜ëŠ” portì˜ type
- selector: ì–´ë–¤ Podë‘ ì—°ê²° ì‹œì¼œì¤„ê²ƒì¸ì§€ labelë¡œ ë¶„ë¥˜
- port: í¬íŠ¸ ì—°ê²° ì •ë³´
    - protocol: TCP ê°€ ê¸°ë³¸ê°’
        port: í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ serviceê°€ ì‚¬ìš©í•˜ëŠ” port
        targetPort: Podê°€ ì‚¬ìš©í•˜ëŠ” port
        nodePort: ì‚¬ìš©ìê°€ ì™¸ë¶€ì—ì„œ ì ‘ì†í•˜ëŠ” port

-----

1. apiVersion í™•ì¸í•˜ê¸°
```
kubectl explain pod
```
- podìë¦¬ëŠ” kind, ì¦‰ service, podë“± ë‹¤ë¥¸ê²Œ ì˜¬ ìˆ˜ ìˆìŒ
- ê°€ì¥ ìƒë‹¨ì— ë²„ì „ì´ ì¶œë ¥ë¨ğŸ‘‡
```
KIND:       Pod
VERSION:    v1
```

2. Podìš© yaml
```yaml
apiVersion: v1
kind: Pod

metadata:
  name: [Pod ì´ë¦„]

spec:
  containers:
    - image: [docker ì´ë¯¸ì§€]
        name: [ì»¨í…Œì´ë„ˆëª…]
```


## í•œ yaml íŒŒì¼ì— ì—¬ëŸ¬ ì˜µì…˜ ìƒì„±í•˜ê¸°
`---` êµ¬ë¶„ì ì‚¬ìš©  
ex)
```
apiVersion: v1
kind: Pod

metadata:
  name: [Pod ì´ë¦„]

spec:
  containers:
    - image: [docker ì´ë¯¸ì§€]
        name: [ì»¨í…Œì´ë„ˆëª…]
---
apiVersion: v1
kind: Pod

metadata:
  name: [Pod ì´ë¦„]

spec:
  containers:
    - image: [docker ì´ë¯¸ì§€]
        name: [ì»¨í…Œì´ë„ˆëª…]
```

# Deploymentìš© yaml íŒŒì¼ ë§Œë“¤ê¸°
1. deployment ë²„ì „ í™•ì¸í•˜ê¸°
```
kubectl explain deployment
```

2. íŒŒì¼ ìƒì„±
```yaml
apiVersion: apps/v1
kind: Pod

metadata:
  name: [Deployment ì´ë¦„]

spec:
  replicas: [Pod ìˆ˜]
  selector:
    matchLabels:
      app:[Podì˜ ë¼ë²¨ëª…]
  template:
    # Pod ì–´ë–»ê²Œ ë§Œë“¤ì§€ ì •ì˜
    metadata:
      labels:
        app: [Podì˜ ë¼ë²¨ëª…]
    # nameì€ ìƒëµ ê°€ëŠ¥ 
      name: [Pod ì´ë¦„]
    spec:
      containers:
        - image: [docker ì´ë¯¸ì§€]
          name: [ì»¨í…Œì´ë„ˆëª…]
          ports:
            -containerPort: [service Port]
```
- nameì´ ì•„ë‹ˆë¼ labelë¡œ ì°¾ì•„ì„œ ì‚¬ìš©í•¨(label ë‹¤ë¥´ë©´ replicaë¶ˆê°€í•¨)

+) ìë™ìœ¼ë¡œ yamlìƒì„±í•˜ê¸°
```
kubectl create deployment app-dp --replicas=2 --image=nginx:1.28 --dry-run -o yaml > app-dp.yaml
```
- app-dpê°€ ì´ë¦„
- --replicas=2 ë ˆí”Œë¦¬ì¹´ ê°œìˆ˜

ì¶œë ¥
```
W0224 11:32:22.336288   17944 helpers.go:731] --dry-run is deprecated and can be replaced with --dry-run=client.
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: app-dp
  name: app-dp
spec:
  replicas: 2
  selector:
    matchLabels:
      app: app-dp
  strategy: {}
  template:
    metadata:
      labels:
        app: app-dp
    spec:
      containers:
      - image: nginx:1.28
        name: nginx
        resources: {}
status: {}
```
- ë¼ë²¨ ì§€ì • ì•ˆ í•˜ë©´ ìë™ìœ¼ë¡œ name=labelì´ ë¨
- ìë™ ìƒì„±í•œ í›„ì— ì›í•˜ëŠ” ë¶€ë¶„ ìˆ˜ì •í•˜ë©´ ë¨

### Resourceê°€ ë­ì˜ˆìš”?
- resources: CPUì™€ ë©”ëª¨ë¦¬ ì–‘ ê²°ì •,  
             ì•ˆì£¼ë©´ ê¸°ë³¸, pod ë¶€ë¶„ì‘ì—… ì‹œí‚¬ ë•Œ ì—¬ê¸°ë‹¤ ì •ì˜í•´ì¤Œ

## YAML ì„¤ì • íŒŒì¼ì— ì •ì˜ëœ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ ìƒì„±
```
kubectl create -f app-dp.yaml
```

- ìˆ˜ì •í•˜ê¸°
```
kubectl edit deployment/app-dp
```
=> ë©”ëª¨ì¥ ì¼œì§, ì—¬ê¸°ì„œ ìˆ˜ì • ê°€ëŠ¥

- pod ë ˆí”Œë¦¬ì¹´ ì‹¤ì‹œê°„ ê°ì‹œí•˜ê¸°
```
kubectl get pods --watch

ì¶œë ¥
app-dp-59854c757-6s9b9   1/1     Running   0          2m21s
app-dp-59854c757-lvdzx   1/1     Running   0          2m21s
```
- docker psì—ì„œ killì‹œì¼œë„ replica=2ë¼ì„œ ê³„ì† ë‹¤ì‹œ ì‚´ì•„ë‚¨
```
docker ps
CONTAINER ID   IMAGE          COMMAND                   CREATED             STATUS             PORTS     NAMES198cd7497318   c541cb94eda1   "/docker-entrypoint.â€¦"   17 seconds ago      Up 16 seconds                k8s_nginx_app-dp-59854c757-6s9b9_default_53b3b0bb-e7e8-40f7-8522-0388bdf629df_1
b12bdf487847   c541cb94eda1   "/docker-entrypoint.â€¦"   3 minutes ago       Up 3 minutes                 k8s_nginx_app-dp-59854c757-lvdzx_default_227829ab-b083-4863-939f-4372efef9f72_0
f30e7b39c4ea   c541cb94eda1   "/docker-entrypoint.â€¦"   About an hour ago   Up About an hour             k8s_web_web_n1_e05c85ec-1dcf-4381-8540-0745a3ecdb8d_0

C:\Users\hi\Desktop\ìˆ˜ì•„\ìˆ˜ì•„ì§±ì§±ë§¨ë¿¡ë¿¡\fullstack-journey\practice_file\0224>docker kill b12

í•˜ë©´

app-dp-59854c757-6s9b9   1/1     Running   0          2m21s
app-dp-59854c757-lvdzx   1/1     Running   0          2m21s
app-dp-59854c757-6s9b9   0/1     Error     0          3m25s
app-dp-59854c757-6s9b9   1/1     Running   1 (1s ago)   3m26s

ì¼ì¼€ ì£½ì—ˆë‹¤ ì‚´ì•„ë‚¨
```

# Service
1. service ë§Œë“¤ê¸°
```yaml
apiVersion: v1
kind: Service

metadata:
  name: app-sv

spec:
  type: NodePort
  selector:
    app: app-label
  ports:
    - protocol: TCP
    # service í¬íŠ¸
    # ì—¬ê¸°ëŠ” ì„ì˜ í¬íŠ¸ë²ˆí˜¸ ì¨ë„ ë¨
      port: 80
    # Pod í¬íŠ¸
    # nginxí¬íŠ¸ì™€ ë§ì¶°ì¤˜ì•¼í•´ì„œ 80
      targetPort: 80
    # ì™¸ë¶€í¬íŠ¸ëŠ” 30000-32767 ì‚¬ì´ë¡œë§Œ ì‚¬ìš© ê°€ëŠ¥
    # ì–˜ ì‚­ì œí•˜ë©´ ìë™ í• ë‹¹ ë¨
      nodePort: 30000

```