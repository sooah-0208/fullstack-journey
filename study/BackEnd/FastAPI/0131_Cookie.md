# 쿠키란?
웹 서버가 생성하여 웹 브라우저로 전송하는 **작은 정보파일**
서버 => 백
브라우저 => 프론트

- 쿠키 1개당 약 4KB
- 도메인당 쿠키 개수 제한 있음  
- API 요청할 때마다 자동으로 서버로 감
- 보안에 취약함: 브라우저에서 수정 가능

사용자에 대한 정보를 웹사이트에 제공 -> 사용자의 경험에 대해 맞춤화하는데 도움이 됨(쇼핑 사이트에서 뭘 장바구니에 담았나 이런 정보를 확인할 수 있음)  

## 쿠키가 직접 저장할 수 있는 정보
- 세션에 접근 가능한 키
- 언어 설정: lang=ko
- 테마: dark_mode=true
- 최근 본 상품 ID 몇 개

## 쿠키가 저장되는 위치
사용자 기기의 지정 파일에 저장됨
웹 브라우저는 Cookies라는 파일에 저장하게 됨 -> 개발자도구 -> 애플리케이션 -> Cookies를 누르면 저장된 쿠키를 확인할 수 있음

## 쿠키의 용도
**사용자의 개인 정보를 식별함**
- 사용자 세션 기억하기: 로그인 유지, 장바구니 유지 등 웹 사이트 접속 상태를 유지시켜줌    
문자와 숫자의 조합으로 이루어진 암호화된 쿠키를 보관함  
ex) 로그인 -> 웹사이트 서버에 세션쿠키 생성 -> 서버에서 브라우저로 전송 -> 사용자의 계정 콘텐츠 로딩 -> 사용자 맞춤 메세지 표출 가능('환영합니다 A님'같은)
다른 페이지를 로드하더라도 해당 쿠키가 있으므로 다시 로그인 할 필요가 없음
- 개인화: 선호하는 언어, 화면구성, 테마 등을 기억해 자동으로 적용시켜줌  
사용자의 정보가 쿠키에 저장되어 브라우저에 전송됨 -> 이를 서버로 전송하면 서버가 사용자의 내역을 가질 수 있음 -> 이를 통해 사용자 개인에게 맞춘 정보를 응답하거나 사용자를 확인하는 요청을 할 수 있음
- 추적: 일부 쿠키는 사용자가 방문한 웹사이트를 기록함. 타사 추적 쿠키를 사용하는 서버를 접속할 경우, 이 정보로 맞춤 광고를 표시할 수 있음.
- 보안: 사용자가 인증 사기를 칠 수 없도록 방지할 수 있음
**보안 문제**
특정 사용자의 이름이나 기기에 결부되지 않은 경우에도 일부 추적유형의 쿠키는 이를 기록하고 실제 사용자의 신원과 연결할 수도 있음  
이는 부적절하게 사용될 가능성도 있음(스토킹, 광고, 모니터링 등)   
현재는 많은 웹 사이트가 사용자 스스로 쿠키를 검토하고 제어할 수 있도록 쿠키 배너를 표기하고있음  

## 쿠키의 종류
1) 세션 쿠키
웹 사이트에서 사용자의 세션을 추적함  
세션 쿠키는 만료일이 없음 -> 사용자의 세션이 종료된 후(로그아웃/사이트 종료 등) 삭제하라고 브라우저에 알림 -> 브라우저에서 삭제

2) 영구 쿠키
만료일을 백에서 지정함  
만료일 이전까지는 사용자의 브라우저에 남아있음  
만료일이 필수  

3) 인증 쿠키
사용자가 계정에 로그인 할 경우에만 생성   
사용자 계정 정보를 쿠키 식별자 문자열과 연결해 중요 정보가 올바른 사용자 세션에 전달되도록 함  
**29/30일에 배운 로그인쿠키가 인증쿠키**

4) 추적 쿠키
사용자의 활동을 기록함  
브라우저는 다음에 추적 서비스를 사용하는 웹사이트를 로드할 때, 이 기록을 관련 추적서비스로 전송함(맞춤화 서비스 제공)

5) 좀비 쿠키
삭제된 후 재생성됨  
일반적인 쿠키 저장 위치말고 외부에 백업버전을 생성함 -> 삭제된 브라우저에도 다시 나타날 수 있음  
**부도덕적** 광고 네트워크 혹은 사이버불링 등에 이용되기도 함

### 타사 쿠키란?
브라우저에 표시 되지 않는 도메인에 속하는 쿠키  
추적 목적으로 가장 많이 사용됨  
```
Alice가 jeans.example.com에서 쇼핑을 할 때, jeans.example.com 원본 서버는 세션 쿠키를 사용하여 사용자가 계정에 로그인했음을 기억합니다. 이것이 1차 당사자 쿠키의 예입니다. 그러나 Alice는 example.ad-network.com의 쿠키도 브라우저에 저장되어 jeans.example.com에서 자신의 활동을 추적하고 있다는 사실을 알지 못할 수도 있습니다. 현재 example.ad-network.com에 접속하고 있지 않더라도 말입니다. 이것이 타사 쿠키의 예입니다
```
-----

# 세션 vs 쿠키

`쿠키`는 **브라우저**(=클라이언트쪽)에 저장되는 작은 데이터 조각    
`세션`은 **서버**에서 사용자 정보를 저장하는 방식
- 사용자가 웹 사이트에 접속하면 서버가 세션 ID생성 -> 사용자의 상태 관리
- 보안성이 높음
- BUT 서버 부하를 증가시킬 수 있음

## 쿠키
사용자의 브라우저에 직접 저장됨  
사용자가 직접 삭제하지 않는 한 오래 유지 가능함  
쉽게 탈취될 수 있어 보안에 취약함  
작은 데이터 조각만 저장 가능함

## 세션
사용자가 브라우저를 닫거나 일정 시간이 지나면 만료됨  
안전하게 사용자 정보를 보호할 수 있음  
대규모 트래픽이 발생하는 사이트에서는 성능 저하를 야기할 수 있음  
사용자의 로그인 정보, 구매 목록 등 대량 데이터를 저장할 수 있음

-------

# 결론
쿠키가 사용자를 식별할 수 있는 키를 가지고 세션에 전달을 하면 세션에서 Data에 접근해 원하는 데이터를 가져와 사용자에게 전달함
쿠키 = 명찰  
세션 = 사물함  
실제 데이터 = 사물함 안  

----

### FrontEnd에서 쿠키 만들기
프론트에서 생성한 쿠키는 사용자가 접근 가능하기 때문에 보안적인 정보는 담지 않아야함
- 언어 설정, UI 상태, 다크모드 등만 저장

in react  

```
import { useCookies } from 'react-cookie'

const [cookies, setCookie, removeCookie] = useCookies(['ck']);

 const boardView = no => 
    setCookie("boardNo", window.btoa(no) )

보통 클릭 이벤트나 submit이벤트에 넣음
```

### BackEnd에서 쿠키 만들기
in python FastAPI  

브라우저에서 req한 정보를 서버가 res에 담아 전송해줌

#### 1. 쿠키 생성

```
from fastapi import FastAPI, Response

app = FastAPI()

@app.get("/set-cookie")
def set_cookie(response: Response):
    response.set_cookie(
        key="user_id",
        value="sooah",
        httponly=True,     # JS 접근 차단
        secure=False,      # HTTPS면 True
        samesite="lax",    # CSRF 방어(lax가 중간단계정도의 보안, 3단계가 있음) 타사이트가 요청해도 막을 수 있는 보안
        max_age=60 * 60    # 1시간
    )
    return {"msg": "쿠키 생성 완료"}

```

#### 2. 쿠키 읽기
```
from fastapi import Cookie

@app.get("/read-cookie")
def read_cookie(user_id: str | None = Cookie(default=None)):
    return {"user_id": user_id}

```

#### 3. 쿠키 삭제
```
@app.get("/delete-cookie")
def delete_cookie(response: Response):
    response.delete_cookie("user_id")
    return {"msg": "쿠키 삭제"}
```